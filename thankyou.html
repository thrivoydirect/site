<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome to Thrivoy!</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f9f9f9; margin:0; padding:20px; }
    .container { max-width:800px; margin:auto; background:white; padding:30px; border-radius:10px; }
    h1 { color:#28a745; }
    .error { background:#f8d7da; color:#721c24; padding:15px; border-radius:8px; margin-top:20px; display:none; }
    .loading { margin:20px 0; }
    .info { background:#e9f7ef; padding:20px; border-radius:8px; margin-top:20px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéâ Welcome to Thrivoy!</h1>
    <p id="business-name-display">Loading your business details...</p>
    <div class="loading" id="loading">‚è≥ Loading...</div>
    <div class="error" id="error"></div>
    <div id="thankyou-content" style="display:none;" class="info">
      <h3>Your Business Info</h3>
      <p><b>Name:</b> <span id="bizName"></span></p>
      <p><b>Owner:</b> <span id="owner"></span></p>
      <p><b>Category:</b> <span id="category"></span></p>
      <p><b>Location:</b> <span id="location"></span></p>
    </div>
  </div>

  <script>
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyhVjQXzsl_pgYGBQkmp3GTIhEeEb25AAZfxj-0CwWnuDd_rRj7u2odPMuW7C4R6d3R/exec";

    function jsonpFetch(params) {
      return new Promise((resolve, reject) => {
        const cbName = "cb_" + Date.now();
        window[cbName] = (resp) => { delete window[cbName]; resolve(resp); };
        const s = document.createElement("script");
        params.callback = cbName;
        s.src = APPS_SCRIPT_URL + "?" + new URLSearchParams(params).toString();
        s.onerror = () => reject(new Error("Network error"));
        document.head.appendChild(s);
      });
    }

    async function loadBusiness() {
      const bizId = new URLSearchParams(window.location.search).get("businessId");
      if (!bizId) { 
        document.getElementById("error").innerText = "Missing businessId"; 
        document.getElementById("error").style.display="block"; 
        return; 
      }
      try {
        const resp = await jsonpFetch({ action:"getThankYou", businessId: bizId });
        document.getElementById("loading").style.display="none";
        if (resp && resp.success) {
          document.getElementById("thankyou-content").style.display="block";
          document.getElementById("business-name-display").innerText = resp.business.businessName;
          document.getElementById("bizName").innerText = resp.business.businessName;
          document.getElementById("owner").innerText = resp.business.ownerName;
          document.getElementById("category").innerText = resp.business.category;
          document.getElementById("location").innerText = resp.business.location;
        } else {
          document.getElementById("error").innerText = resp.error || "Error loading business data";
          document.getElementById("error").style.display="block";
        }
      } catch(err) {
        document.getElementById("loading").style.display="none";
        document.getElementById("error").innerText = err.message;
        document.getElementById("error").style.display="block";
      }
    }
    loadBusiness();
  </script>
</body>
</html>
