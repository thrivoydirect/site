<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard ‚Äì Thrivoy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #f9fafb;
      margin: 0;
      padding: 0;
      color: #333;
    }
    header {
      background: #073378;
      color: white;
      padding: 20px;
      text-align: center;
    }
    header h1 {
      margin: 0;
      font-size: 1.8rem;
    }
    main {
      max-width: 1000px;
      margin: 30px auto;
      background: #fff;
      padding: 25px 30px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    h2 {
      color: #073378;
      margin-top: 1.5em;
    }
    .stat-box {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .stat {
      background: #f1f5f9;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .stat h3 {
      margin: 0;
      font-size: 1.2rem;
      color: #073378;
    }
    .stat p {
      font-size: 1.6rem;
      font-weight: bold;
      margin: 5px 0 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      text-align: left;
      padding: 10px;
      border-bottom: 1px solid #eee;
    }
    th {
      background: #f1f5f9;
    }
    a.button {
      display: inline-block;
      padding: 10px 16px;
      margin: 10px 5px 0 0;
      background: #073378;
      color: #fff;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      transition: background 0.2s;
    }
    a.button:hover {
      background: #05285c;
    }
    footer {
      text-align: center;
      padding: 20px;
      margin-top: 30px;
      font-size: 0.85rem;
      color: #777;
    }
  </style>
</head>
<body>
  <header>
    <h1>üìä Thrivoy Dashboard</h1>
  </header>

  <main>
    <div id="status">‚è≥ Loading dashboard...</div>

    <section id="stats"></section>
    <section id="subscription"></section>
    <section id="invoices"></section>
    <section id="actions"></section>
  </main>

  <footer>
    &copy; <span id="year"></span> Thrivoy. All rights reserved.
  </footer>

  <script>
  // === CONFIG ===
  const CONFIG = {
    APPS_SCRIPT_URL: "https://script.google.com/macros/s/AKfycbwu9uMUiZX1sAJQ7ygUumw3tXwaegk8v9iBkCrSpFdIF8Ua5eICTr6Otq0MJhc6I12smg/exec" // üëâ replace
  };

  // === Utility ===
  function getQueryParam(name) {
    const params = new URLSearchParams(window.location.search);
    return params.get(name);
  }

  async function loadDashboard() {
    const bizId = getQueryParam("businessId") || getQueryParam("id") || getQueryParam("biz");
    const statusEl = document.getElementById("status");
    const statsEl = document.getElementById("stats");
    const subEl = document.getElementById("subscription");
    const invoicesEl = document.getElementById("invoices");
    const actionsEl = document.getElementById("actions");

    if (!bizId) {
      statusEl.innerHTML = "‚ùå No Business ID provided.";
      return;
    }

    try {
      const url = `${CONFIG.APPS_SCRIPT_URL}?action=getDashboard&businessId=${encodeURIComponent(bizId)}`;
      const resp = await fetch(url);
      const data = await resp.json();

      if (!data.success) {
        statusEl.innerHTML = "‚ùå Error: " + (data.error || "Unknown problem");
        return;
      }

      statusEl.innerHTML = "‚úÖ Dashboard loaded.";

      // Stats
      statsEl.innerHTML = `
        <h2>üìà Key Stats</h2>
        <div class="stat-box">
          <div class="stat"><h3>Website Visits</h3><p>${data.stats?.visits || 0}</p></div>
          <div class="stat"><h3>Leads</h3><p>${data.stats?.leads || 0}</p></div>
          <div class="stat"><h3>Conversions</h3><p>${data.stats?.conversions || 0}</p></div>
        </div>
      `;

      // Subscription
      subEl.innerHTML = `
        <h2>üíº Subscription</h2>
        <p><strong>Plan:</strong> ${data.subscription?.plan || "Free Trial"}</p>
        <p><strong>Status:</strong> ${data.subscription?.status || "trial"}</p>
        <p><strong>Trial Ends:</strong> ${data.subscription?.trialEndsAt || "N/A"}</p>
      `;

      // Invoices
      if (data.invoices && data.invoices.length > 0) {
        let rows = data.invoices.map(inv => `
          <tr>
            <td>${inv.invoiceId || "N/A"}</td>
            <td>${inv.amount || "N/A"}</td>
            <td>${inv.status || "pending"}</td>
            <td>${inv.date || "N/A"}</td>
            <td>${inv.upiDeepLink ? `<a href="${inv.upiDeepLink}" target="_blank">Pay Now</a>` : ""}</td>
          </tr>
        `).join("");
        invoicesEl.innerHTML = `
          <h2>üí≥ Invoices</h2>
          <table>
            <thead>
              <tr><th>Invoice ID</th><th>Amount</th><th>Status</th><th>Date</th><th>Action</th></tr>
            </thead>
            <tbody>${rows}</tbody>
          </table>
        `;
      } else {
        invoicesEl.innerHTML = "<h2>üí≥ Invoices</h2><p>No invoices found.</p>";
      }

      // Actions
      actionsEl.innerHTML = `
        <h2>‚ö° Quick Actions</h2>
        <a href="${data.websiteUrl || "#"}" target="_blank" class="button">üåê View Website</a>
        <a href="thankyou.html?businessId=${bizId}" class="button">üéâ Thank You Page</a>
      `;

    } catch (err) {
      statusEl.innerHTML = "‚ùå Failed to load dashboard: " + err.message;
    }
  }

  document.getElementById("year").textContent = new Date().getFullYear();
  document.addEventListener("DOMContentLoaded", loadDashboard);
  </script>
</body>
</html>
